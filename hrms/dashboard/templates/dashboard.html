{% extends "base.html" %}

{% block title %} Dashboard {% endblock %}

{% block top_heading %}Dashboard{% endblock %} 

{% block user_first_name1 %}{{user.first_name}} {% endblock %} 
{% block user_first_name2 %}{{user.first_name}} {% endblock %} 
{% block user_last_name %}{{user.last_name}} {% endblock %}
{% block username %}{{user.username}} {% endblock %}

 
{% block content %}
<section class="section dashboard">
    <div class="row">

      <!-- Left side columns -->
      <div class="col-lg-12">
        <div class="row">

            <div class="col-md-6">
                <div class="card info-card sales-card">

                    <div class="card-body">
                        <h5 class="card-title">Normal Employees <span></span></h5>

                        <div class="d-flex align-items-center">
                          <!-- <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                              <i class="bi bi-people-fill"></i>
                          </div> -->
                          <div class="ps-3">
                              <h6 class ="value" akhi="{{no_of_normal_employees}}">{{no_of_normal_employees}}</h6>
                              <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

                          </div>
                        </div>
                    </div>
                
                </div>
            </div><!-- End Sales Card -->
            <div class="col-md-6">
              <div class="card info-card sales-card">

                  <div class="card-body">
                      <h5 class="card-title">Shift Employees <span></span></h5>

                      <div class="d-flex align-items-center">
                        <!-- <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                            <i class="bi bi-people-fill"></i>
                        </div> -->
                        <div class="ps-3">
                            <h6 class ="value" akhi="{{no_of_shift_employees}}">{{no_of_shift_employees}}</h6>
                            <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

                        </div>
                      </div>
                  </div>
              
              </div>
          </div><!-- End Sales Card -->
            
            <div class="col-md-3">
                <div class="card info-card sales-card">

                    <div class="card-body">
                        <h5 class="card-title">Last Month Total Salary <span></span></h5>

                        <div class="d-flex align-items-center">
                        <!-- <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                            <i class="bi bi-currency-dollar"></i>
                        </div> -->
                        <div class="ps-3">
                            <h6 id="dashboard_last_month_salary" class ="value" akhi="156000.00">0</h6>
                            <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

                        </div>
                        </div>
                    </div>
                
                </div>
            </div><!-- End Sales Card -->
            <div class="col-md-3">
                <div class="card info-card sales-card">

                    <div class="card-body">
                        <h5 class="card-title">Last Month Salary Advance<span></span></h5>

                        <div class="d-flex align-items-center">
                        <!-- <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                            <i class="bi bi-currency-dollar"></i>
                        </div> -->
                        <div class="ps-3">
                            <h6 id="dashboard_last_month_salary_advance" class ="value" akhi="156000.00">0</h6>
                            <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

                        </div>
                        </div>
                    </div>
                
                </div>
            </div><!-- End Sales Card -->
            <div class="col-md-3">
              <div class="card info-card sales-card">

                  <div class="card-body">
                      <h5 class="card-title">Last Month Total Allowance<span></span></h5>

                      <div class="d-flex align-items-center">
                      <!-- <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                          <i class="bi bi-currency-dollar"></i>
                      </div> -->
                      <div class="ps-3">
                          <h6 id="dashboard_last_month_allowance" class ="value" akhi="156000.00">0</h6>
                          <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

                      </div>
                      </div>
                  </div>
              
              </div>
          </div><!-- End Sales Card -->
            <div class="col-md-3">
              <div class="card info-card sales-card">

                  <div class="card-body">
                      <h5 class="card-title">Last Month Total EPF<span></span></h5>

                      <div class="d-flex align-items-center">
                      <!-- <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                          <i class="bi bi-currency-dollar"></i>
                      </div> -->
                      <div class="ps-3">
                          <h6 id="dashboard_last_month_epf" class ="value" akhi="156000.00">0</h6>
                          <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

                      </div>
                      </div>
                  </div>
              
              </div>
          </div><!-- End Sales Card -->
        </div>
    </div>
</div>
<div class="row">
  <div class="col-8">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Salary Summary Chart</h5>

        <!-- Column Chart -->
        <div id="columnChart"></div>
        <!-- End Column Chart -->

      </div>
    </div>
  </div>
  <div class="col-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Employee Growth</h5>

        <!-- Column Chart -->
        <div id="employeeCountChart"></div>
        <!-- End Column Chart -->

      </div>
    </div>
  </div>
</div>


</section>

<script>
//   const counters = document.querySelectorAll('.value');
//   const speed = 200;

//   counters.forEach( counter => {
//     const animate = () => {
//         const value = +counter.getAttribute('akhi');
//         const data = +counter.innerText;
      
//         const time = value / speed;
//       if(data < value) {
//             counter.innerText = Math.ceil(data + time);
//             setTimeout(animate, 1);
//           }else{
//             counter.innerText = value;
//           }
      
//     }
    
//     animate();
// });
$( document ).ready(function() {
  console.log("Inside")
  $.ajax({
        type: 'GET',
        url: "{% url 'get_salary_summary_data' %}",
        success: function (response) { 
            document.getElementById("dashboard_last_month_salary").innerHTML = response["last_month_salary"]
            document.getElementById("dashboard_last_month_salary_advance").innerHTML = response["last_month_salary_advance"]
            document.getElementById("dashboard_last_month_allowance").innerHTML = response["last_month_allowance"]
            document.getElementById("dashboard_last_month_epf").innerHTML = response["last_month_epf"]
            new ApexCharts(document.querySelector("#columnChart"), {
              series: [ {
                name: 'Net Salary',
                data: [response["monthly_net_salary_payed_record"][0][2], response["monthly_net_salary_payed_record"][1][2], response["monthly_net_salary_payed_record"][2][2], response["monthly_net_salary_payed_record"][3][2], response["monthly_net_salary_payed_record"][4][2], response["monthly_net_salary_payed_record"][5][2]]
              },{
                name: 'Salary Advance',
                data: [response["monthly_net_salary_payed_record"][0][4], response["monthly_net_salary_payed_record"][1][4], response["monthly_net_salary_payed_record"][2][4], response["monthly_net_salary_payed_record"][3][4], response["monthly_net_salary_payed_record"][4][4], response["monthly_net_salary_payed_record"][5][4]]
              },{
                name: 'EPF',
                data: [response["monthly_net_salary_payed_record"][0][5], response["monthly_net_salary_payed_record"][1][5], response["monthly_net_salary_payed_record"][2][5], response["monthly_net_salary_payed_record"][3][5], response["monthly_net_salary_payed_record"][4][5], response["monthly_net_salary_payed_record"][5][5]]
              },{
                name: 'Alowance',
                data: [response["monthly_net_salary_payed_record"][0][6], response["monthly_net_salary_payed_record"][1][6], response["monthly_net_salary_payed_record"][2][6], response["monthly_net_salary_payed_record"][3][6], response["monthly_net_salary_payed_record"][4][6], response["monthly_net_salary_payed_record"][5][6]]
              }],
              chart: {
                type: 'bar',
                height: 350
              },
              // colors: ['#4154f1'],
              plotOptions: {
                bar: {
                  horizontal: false,
                  columnWidth: '70%',
                  endingShape: 'rounded'
                },
              },
              dataLabels: {
                enabled: false
              },
              stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
              },
              xaxis: {
                categories: [response["monthly_net_salary_payed_record"][0][1], response["monthly_net_salary_payed_record"][1][1], response["monthly_net_salary_payed_record"][2][1], response["monthly_net_salary_payed_record"][3][1], response["monthly_net_salary_payed_record"][4][1], response["monthly_net_salary_payed_record"][5][1]],
              },
              yaxis: {
                title: {
                  text: 'Rs (Rupees)'
                }
              },
              fill: {
                opacity: 1
              },
              tooltip: {
                y: {
                  formatter: function(val) {
                    return "Rs " + val 
                  }
                }
              }
            }).render();
            // console.log(response["monthly_net_salary_payed_record"][0], response["monthly_net_salary_payed_record"][1], response["monthly_net_salary_payed_record"][2], response["monthly_net_salary_payed_record"][3][1], response["monthly_net_salary_payed_record"][4][3], response["monthly_net_salary_payed_record"][5][3])
            new ApexCharts(document.querySelector("#employeeCountChart"), {
                        series: [{
                          name: 'Employees',
                          // data: [31, 40, 28, 51, 42, 82],
                          data: [response["monthly_net_salary_payed_record"][0][3], response["monthly_net_salary_payed_record"][1][3], response["monthly_net_salary_payed_record"][2][3], response["monthly_net_salary_payed_record"][3][3], response["monthly_net_salary_payed_record"][4][3], response["monthly_net_salary_payed_record"][5][3]],
                        }],
                        chart: {
                          height: 350,
                          type: 'area',
                          toolbar: {
                            show: false
                          },
                        },
                        markers: {
                          size: 4
                        },
                        colors: ['#4154f1'],
                        fill: {
                          type: "gradient",
                          gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.3,
                            opacityTo: 0.4,
                            stops: [0, 90, 100]
                          }
                        },
                        dataLabels: {
                          enabled: false
                        },
                        stroke: {
                          curve: 'smooth',
                          width: 2
                        },
                        xaxis: {
                          type: 'text',
                          categories: [response["monthly_net_salary_payed_record"][0][1], response["monthly_net_salary_payed_record"][1][1], response["monthly_net_salary_payed_record"][2][1], response["monthly_net_salary_payed_record"][3][1], response["monthly_net_salary_payed_record"][4][1], response["monthly_net_salary_payed_record"][5][1]]
                        },
                        // tooltip: {
                        //   x: {
                        //     format: 'dd/MM/yy HH:mm'
                        //   },
                        // }
                      }).render();
        }
    });
});

</script>

{% endblock %}